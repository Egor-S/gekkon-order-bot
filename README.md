## Системные требования:
- `git`
- `Python 3`
- `virtualenv`

> Установить недостающие компоненты можно с помощью системного пакетного менеджера (`apt-get`, `yum`, `pacman` и т.д.)

## Загрузка проекта

```bash
git clone https://github.com/Egor-S/gekkon-order-bot.git
cd gekkon-order-bot
```

## Подготовка аккаунтов
### `telegram.secret`
Написать `@BotFather`, следовать указаниям. В ответ будет получено сообщение с токеном - поместите его в файл `telegram.secret` в скаченной ранее папке.

### `google_service.json`
Зайдите на сайт [Google API Console](https://console.developers.google.com/projectselector/apis/dashboard?pli=1) и выберите `Создать проект`.

После создания перейдите в раздел `Учетные данные` и нажмите на `Создать учетные данные` --> `Ключ сервисного аккаунта`. Создайте новый сервисный аккаунт с ключом типа `JSON`.

В завершение процедуры создания учетных данных будет скачан файл, который необходимо переименовать в `google_service.json` и поместить в скаченную ранее папку.

### Google таблицы
Разрешите чтение/запись для e-mail из файла `google_service.json` в нужных таблицах (Google может прислать письмо, что такого ящика не существует - не обращайте внимание).

Структура каталога: на листе `items` три колонки начиная **со второй строки**

1. Артикул (трехзначное число) \[Столбец A\]
2. Короткое название \[Столбец B\]
3. Описание \[Столбец C\]

В таблице с заказами нужно создать лист `orders`, а **в первой строке** разместить заголовки (id, артикул, название, количество, имя сотрудника, дата). В первой колонке, начиная со второй строки, указываются id заказов.

В файле `config.py` запишите:
- id таблицы с листом `items` в переменную `PRODUCTION_CHAT_ID`
- id таблицы с листом `orders` в переменную `ORDERS_TABLE_ID`

> Оба листа можно разместить в одной таблице, тогда в обе переменные нужно записать один и тот же id

### Подготовка окружения
Создаем виртуальное окружение:

```bash
virtualenv venv -p python3
```

Устанавливаем зависимости:

```bash
env/bin/pip install -r requirements.txt
```

Запускаем бота:

```bash
env/bin/python run.py
```

Если все действия выполнены правильно, то будет выведено сообщение формата "Logged in as @YourBotName".

Для остановки бота нажмите `Ctrl+C`.

### Канал для оповещений
Добавьте бота в нужный канал и вызовите команду `/chatid` (он должен быть запущен). Полученное значение (для групп со знаком минус) запишите в переменную `PRODUCTION_CHAT_ID` в файле `config.py`.

### Завершение настройки
Настройте удобным для вас способом (`cron`, `rc.local` и т.д.) запуск бота при старте системы.

**Важно!** Запускать бота необходимо из директории проекта:

```bash
cd /path/to/gekkon-order-bot
venv/bin/python run.py &
```